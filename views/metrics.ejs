<!DOCTYPE html>
<html>
<%- include("head.ejs") %>
<link href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.11/c3.min.css" rel="stylesheet" type="text/css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.11/c3.min.js"></script>
<body>
<%- include("header.ejs") %>
<div class="container">
    <br>
    <div id="daily_count"></div>
</div>
<script type="text/javascript">
var dateFormat = d3.time.format.utc("%Y-%m-%d");
var chart = c3.generate({
    bindto: '#daily_count',
    data: {
        xs: {
            "Number of Students/Day": "Date",
            "Number of Students/Hr": "Hour"
        },
        rows: [],
        type: 'bar',
        onclick: function(d, element) {
            chart.hide("Number of Students/Day");
            chart.show("Number of Students/Hr");
            var nextDay = new Date(d.x);
            nextDay.setDate(nextDay.getDate()+1);
            chart.zoom([d.x, nextDay]);
        },
        hide: "Number of Students/Hr"
    },
    axis: {
        x: {
            type: 'timeseries',
            localtime: false,
            tick: {
                format: function(x) {
                    return dateFormat(x);
                },
                culling: 12
            }
        }
    },
    bar: {
        width: {
            ratio: 1
        }
    },
    zoom: {
        enabled: false
    }
});
//var thirtyDaysAgo = new Date();
//thirtyDaysAgo.setDate(thirtyDaysAgo.getDate()-30);
var dailyRows = [["Date", "Number of Students/Day"]];
$.get("/metrics/counts.json?granularity=day", function(json) {
    json.forEach(function(item) {
        dailyRows.push([new Date(item.time), item.count]);
    });
    chart.load({
        rows: dailyRows
    });
});
var hourlyRows = [["Hour", "Number of Students/Hr"]];
$.get("/metrics/counts.json?granularity=hour", function(json) {
    json.forEach(function(item) {
        hourlyRows.push([new Date(item.time), item.count]);
    });
    chart.load({
        rows: hourlyRows
    });
});
</script>
<%- include("footer.ejs") %>
</body>
</html>
